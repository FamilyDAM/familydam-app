(this.webpackJsonpauth=this.webpackJsonpauth||[]).push([[0],{144:function(e,t){},156:function(e,t,s){e.exports=s(434)},170:function(e,t){},176:function(e,t){},181:function(e,t,s){},433:function(e){e.exports=JSON.parse("{}")},434:function(e,t,s){"use strict";s.r(t);var r=s(150),a=s(0),i=s.n(a),n=s(22),o=s.n(n),l=s(47);const c=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function registerValidSW(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}var d=s(149),h=s(468),p=s(146),u=s.n(p),m=s(147),g=s.n(m),w=s(148),f=s.n(w),v=(s(181),s(13)),b=s(145),C=s.n(b);class Clock_Clock extends a.Component{constructor(e,t){super(e),this.state={timestamp:(new Date).getTime()}}componentDidMount(){this.timer=setInterval(this.tick,1e3)}componentWillUnmount(){clearInterval(this.timer)}tick(){}render(){var e=this.props.classes;return i.a.createElement("div",null,i.a.createElement("div",{className:e.timestamp},C()().format("h:mm:ss a")))}}var E=Object(v.a)(e=>({timestamp:{position:"absolute",bottom:"15px",left:"20px",fontSize:"48px",color:"#fff",opacity:".7"}}))(Clock_Clock),S=s(464),x=s(465),k=s(463),y=s(436),L=s(467),N=s(466),U=s(132),A=s.n(U);class LoadingButton_LoadingButton extends a.Component{constructor(e,t){e.style||(e.style={}),super(e),this.handleClick=this.handleClick.bind(this)}shouldComponentUpdate(e,t){return e.label!==this.props.label}handleClick(e){console.log("loading button click"),this.props.onClick?this.props.onClick(e):console.dir(this.props)}render(){var e=this.props.classes;return i.a.createElement(k.a,{color:"primary",variant:"contained",className:e.btn,style:this.props.style,onClick:this.handleClick},this.props.isLoading&&i.a.createElement(S.a,{className:e.progress,color:"#fff",size:25}),this.props.label)}}var _=Object(l.d)(Object(v.a)(e=>({btn:{padding:"4px 12px"},progress:{marginRight:"8px"}}))(LoadingButton_LoadingButton));class LoginCard_LoginCard extends a.Component{constructor(e,t){super(e),this.state={user:{firstName:"",lastName:"",email:""},password:"",mode:"minimal",isLoading:!1},this.handleSelect=this.handleSelect.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleLogin=this.handleLogin.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}componentWillMount(){this.setState({isLoading:!1})}componentDidMount(){this.refs.pwdField&&this.refs.pwdField.focus()}handleCancel(){this.setState({mode:"minimal",isLoading:!1}),this.props.onCancel&&this.props.onCancel()}handleLogin(){this.setState({isLoading:!0}),this.props.onLogin&&this.props.onLogin(this.props.user.id,this.state.password)}handleKeyDown(e){"Enter"===e.key&&this.handleLogin()}handleSelect(){this.setState({mode:"extended"}),this.props.onSelect&&this.props.onSelect(this.props.user)}render(){var e=this.props.classes;return"minimal"===this.state.mode?i.a.createElement(x.a,{style:{width:"150px",height:"176px"}},i.a.createElement(y.a,{focusRipple:!0,onClick:this.handleSelect,style:{width:"100%",backgroundColor:"#fff"}},i.a.createElement(A.a,{style:{width:120,height:120}})),i.a.createElement(y.a,{focusRipple:!0,onClick:this.handleSelect,style:{width:"100%",backgroundColor:"#fff"}},i.a.createElement("h2",{style:{textAlign:"center"}},this.props.user.firstName))):i.a.createElement(x.a,{style:{width:"450px",height:"200px"}},i.a.createElement("div",{className:e.extendedContainer},i.a.createElement("div",{style:{gridRow:"2/5",gridColumn:"1",textAlign:"center"}},i.a.createElement(A.a,{style:{width:120,height:120}})),i.a.createElement("div",{style:{gridRow:"2",gridColumn:"2"}},i.a.createElement(N.a,{type:"title",style:{textAlign:"left"}},this.props.user.firstName)),i.a.createElement("div",{style:{gridRow:"3",gridColumn:"2"}},i.a.createElement(L.a,{type:"password",label:"Password",required:!0,style:{width:"100%"},value:this.state.password,onKeyDown:this.handleKeyDown,onChange:e=>{this.setState({password:e.target.value})}})),i.a.createElement("div",{style:{gridRow:"4",gridColumn:"2"}},i.a.createElement(k.a,{color:"primary",onClick:this.handleCancel},"Cancel"),i.a.createElement(_,{isLoading:this.state.isLoading,label:"Login",onClick:this.handleLogin}))))}}var j=Object(v.a)(e=>({personalCard:{border:"1px solid"},extendedContainer:{display:"grid",gridGap:"16px",gridTemplateColumn:"125px auto auto auto",gridTemplateRows:"16px auto auto auto auto 16px"}}))(LoginCard_LoginCard);class LoginCards_LoginCards extends a.Component{constructor(e,t){super(e),this.state={selectedUser:null},this.handleLogin=this.handleLogin.bind(this)}componentDidMount(){this.refs.pwdField&&this.refs.pwdField.focus()}handleLogin(e,t){this.props.onLogin&&this.props.onLogin(e,t)}handleSelect(e){this.props.onSelect(this.props.user)}render(){var e=this.props.classes;let t=[];return this.props.users&&(t=this.props.users,null!==this.state.selectedUser&&(t=t.filter(e=>e.id===this.state.selectedUser.id))),i.a.createElement("div",{className:e.outerContainer},i.a.createElement("div",{style:{gridColumn:"2/3",gridRow:"2/3"}},i.a.createElement("div",{className:e.loginGrids},t.map(t=>i.a.createElement("div",{key:t.id,className:e.loginCardItem},i.a.createElement(j,{user:t,onLogin:this.handleLogin,onCancel:e=>this.setState({selectedUser:null}),onSelect:e=>this.setState({selectedUser:e})}))))))}}var T=Object(v.a)(e=>({outerContainer:{width:"100%",height:"100%",display:"grid",gridGap:"24px",gridTemplateRows:"1fr 80% 1fr",gridTemplateColumns:"1fr 80% 1fr"},loginGrids:{width:"100%",height:"100%",display:"grid",gridGap:"24px",gridAutoRows:"auto",gridTemplateColumns:"repeat(auto-fill, 150px)"},loginCardItem:{}}))(LoginCards_LoginCards),G=s(26);var P=new class AppSettings_AppSettings{constructor(){this.baseHost=new G.BehaviorSubject("http://locaalhost:9000"),this.basicUser=new G.BehaviorSubject(window.localStorage.getItem("u")),this.basicPwd=new G.BehaviorSubject(window.localStorage.getItem("p"))}};var F=class LoginService_LoginService{constructor(e,t){this.sink=void 0,this.sink=t,e.subscribe(this.login.bind(this))}login(e){var t=P.baseHost.getValue()+"/login";let s=new FormData;s.append("username",e.username),s.append("password",e.password),fetch(t,{method:"POST",body:s}).then(e=>{console.log("login success handler"),console.dir(e),e.redirected&&(console.log("redirect to: "+e.url),e.url.indexOf("/home/")>-1&&(window.location=e.url))}).catch(e=>{console.warn(e),window.location="/"})}},O=s(131),V=s.n(O);var M=class LoadClientAppsService_LoginService{constructor(e,t){this.sink=void 0,this.sink=t,e.subscribe(this.loadApps.bind(this))}loadApps(e){V.a.get("/api/v1/core/clientapps").withCredentials().set("Accept","application/json").end((e,t)=>{if(e)if(401===e.status)I.navigateTo.next("/");else if(403===e.status){var s={code:e.status,message:"Invalid Login (todo: show toast)"};this.sink.error(s)}else{console.dir(e);var r={code:e.status,status:e.statusText,message:e.responseText};this.sink.error(r)}else this.sink.next({primaryApps:t.body.apps.primary,secondaryApps:t.body.apps.secondary})})}};var R=class LogoutService_LogoutService{constructor(e,t){this.sink=void 0,this.sink=t,e.subscribe(this.getUser.bind(this))}getUser(e){const t=P.baseHost.getValue();fetch(t+"/logout",{method:"GET"}).then(e=>(e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),e)).catch(e=>{if(401===e.status||403===e.status)window.location="/";else{var t={code:e.status,status:e.statusText,message:e.responseText};this.sink.error(t)}})}};var I=new class AppActions_AppActions{constructor(){this.navigateTo=new G.Subject,this.logout={source:new G.Subject,sink:new G.Subject},this.loadClientApps={source:new G.Subject,sink:new G.Subject},this.loadClientAppsService=new M(this.loadClientApps.source,this.loadClientApps.sink),this.logoutService=new R(this.logout.source,this.logout.sink)}};var W=class CreateUserService_CreateUserService{constructor(e,t){this.sink=void 0,this.sink=t,e.subscribe(function(e){this.createUser(e)}.bind(this))}createUser(e){e.username||(e.username=e.userProps.firstName.toLowerCase()),e.username;var t=new FormData;t.append(":name",e.username),t.append("pwd",e.password),t.append("pwdConfirm",e.password),t.append("firstName",e.userProps.firstName),t.append("lastName",e.userProps.lastName),t.append("email",e.userProps.email),t.append("isFamilyAdmin",e.isFamilyAdmin);const s=P.baseHost.getValue();fetch(s+"/api/v1/auth/user",{method:"POST",body:t}).then(e=>{console.log("CreateeUser success handler"),console.dir(e),e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),this.sink.next(!0)}).catch(e=>{if(console.warn(e),401===e.status)I.navigateTo.next("/");else if(409===e.status)I.alert.next("User already exists");else if(403===e.status)I.alert.next("You do not have permission to add a new user");else{var t={code:e.status,status:e.statusText,message:e.responseText};this.sink.error(t)}})}};var D=new class AuthActions_AuthActions{constructor(){this.login={source:new G.Subject,sink:new G.Subject},this.createUser={source:new G.Subject,sink:new G.Subject},this.loginService=new F(this.login.source,this.login.sink),this.createUserService=new W(this.createUser.source,this.createUser.sink)}};var B=class GetUserService_GetUsersService{constructor(e,t){this.sink=void 0,this.sink=t,e.subscribe(this.getUser.bind(this))}getUser(e){const t=P.baseHost.getValue();fetch(t+"/api/v1/auth/user/me",{method:"GET"}).then(e=>(e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),e)).then(e=>e.json()).then(e=>{e.firstName||(e.firstName=e.username),this.sink.next(e)}).catch(e=>{if(401===e.status||403===e.status)window.location="/";else{var t={code:e.status,status:e.statusText,message:e.responseText||e.message};this.sink.error(t)}})}},q=s(101),H=s.n(q),K=s(133);var z=class GetAllUsersService_GetAllUsersService{constructor(e,t,s){this.sink=void 0,this.sink=t,e.subscribe(this.getUsers.bind(this))}getUsers(){var e=this;return Object(K.a)(H.a.mark((function _callee2(){var t,s,r,a;return H.a.wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:return t=P.baseHost.getValue(),s=t+"/api/v1/auth/users",(r=new Headers).append("pragma","no-cache"),r.append("cache-control","no-cache"),i.next=7,fetch(s,{method:"GET",cache:"no-cache",headers:r}).then(function(){var e=Object(K.a)(H.a.mark((function _callee(e){return H.a.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.json());case 1:case"end":return t.stop()}}),_callee)})));return function(t){return e.apply(this,arguments)}}()).then(e=>{for(var t=[],s=0;s<e.length;s++){var r=e[s];void 0===r.firstName&&(r.firstName=r.username),t.push(r)}return t.sort((function(e,t){return e.username>t.username?1:e.username<t.username?-1:0}))}).catch(e=>{if(401===e.status||403===e.status)window.location="/";else{var t={code:e.status,status:e.statusText,message:e.responseText||e.message};console.warn(t),setTimeout(()=>{J.getAllUsers.source.next(!0)},500)}});case 7:(a=i.sent)&&e.sink.next(a);case 9:case"end":return i.stop()}}),_callee2)})))()}};var J=new class UserActions_UserActions{constructor(){this.getUser={source:new G.Subject,sink:new G.Subject},this.getAllUsers={source:new G.Subject,sink:new G.Subject},this.getUserService=new B(this.getUser.source,this.getUser.sink),this.getAllUsersService=new z(this.getAllUsers.source,this.getAllUsers.sink)}};class GridContainer_GridContainer extends a.Component{render(){var e={};return this.props.style&&(e=this.props.style),e.display="grid",e.width,e.height,e.gridGap||(e.gridGap=this.props.gap),e.gridTemplateRows||(e.gridTemplateRows=this.props.rowTemplate),e.gridTemplateColumns||(e.gridTemplateColumns=this.props.columnTemplate),i.a.createElement("div",Object.assign({style:e},this.props),this.props.children)}}var X=GridContainer_GridContainer;class GridItem_GridItem extends a.Component{render(){var e={};return this.props.style&&(e=this.props.style),e.gridGap||(e.gridGap=this.props.gap),e.gridTemplateRows||(e.gridRow=this.props.rows),e.gridTemplateColumns||(e.gridColumn=this.props.columns),i.a.createElement("div",{style:e},this.props.children)}}var $=GridItem_GridItem;class SignupCard_SignupCard extends a.Component{constructor(e,t){super(e),this.state={isLoading:!1,firstNameError:"",lastNameError:"",emailError:"",passwordError:"",confirmPasswordError:"",user:{firstName:"",lastName:"",email:"",password:"",confirmPassword:""}},this.handleSubmit=this.handleSubmit.bind(this)}componentWillUnmount(){this.createUserSubscription}componentDidMount(){}clearValidationErrors(){this.setState({firstNameError:"",lastNameError:"",emailError:"",passwordError:"",confirmPasswordError:""})}isValidForm(){this.clearValidationErrors();let e=!0;return this.state.firstName||(e=!1,this.setState({firstNameError:"First name is required"})),this.state.email||(e=!1,this.setState({emailError:"Email is required"})),this.state.password||(e=!1,this.setState({passwordError:"A password is required"})),e}handleSubmit(e){if(console.log("handleSubmit - create user"),this.state.isLoading)return;let t=this.isValidForm();if(this.state.password!==this.state.confirmPassword&&(t=!1,this.setState({confirmPasswordError:"The passwords must match"})),t){this.setState({isLoading:!0});var s={};s.username=this.state.firstName.toLowerCase(),s.password=this.state.password,s.isFamilyAdmin=!0,s.userProps={},s.userProps.firstName=this.state.firstName,s.userProps.lastName=this.state.lastName,s.userProps.email=this.state.email,this.createUserSubscription=D.createUser.sink.subscribe(e=>{console.log("AuthActions.createUser.sink: "),console.dir(e),this.setState({isLoading:!1}),J.getAllUsers.source.next(!0)},e=>{alert(e)}),D.createUser.source.next(s)}}render(){var e=this.props.classes;return i.a.createElement(x.a,{style:{maxWidth:"800px"}},i.a.createElement(X,{gap:"16px",rowTemplate:"48px auto",columnTemplate:"1fr 1fr",style:{margin:"16px"}},i.a.createElement($,{rows:"1",columns:"1 / 3",style:{borderBottom:"1px solid #ccc"}},i.a.createElement("h2",null,i.a.createElement(l.a,{id:"SignupCard.label",defaultMessage:"Create First User"}))),i.a.createElement($,{rows:"2",columns:"1/2"},i.a.createElement(L.a,{label:"First Name",required:!0,className:e.textField,value:this.state.firstName,onChange:e=>{this.setState({firstName:e.target.value}),this.clearValidationErrors()},error:this.state.firstNameError.length>0,helperText:this.state.firstNameError})),i.a.createElement($,{rows:"2",columns:"2/3"},i.a.createElement(L.a,{label:"Last Name",className:e.textField,value:this.state.lastName,onChange:e=>{this.setState({lastName:e.target.value}),this.clearValidationErrors()},error:this.state.lastNameError.length>0,helperText:this.state.lastNameError})),i.a.createElement($,{rows:"3",columns:"1/3"},i.a.createElement(L.a,{label:"Email",required:!0,className:e.textField,value:this.state.email,onChange:e=>{this.setState({email:e.target.value}),this.clearValidationErrors()},error:this.state.emailError.length>0,helperText:this.state.emailError})),i.a.createElement($,{rows:"4",columns:"1/3"},i.a.createElement(L.a,{type:"password",label:"Password",required:!0,className:e.textField,value:this.state.password,onChange:e=>{this.setState({password:e.target.value}),this.clearValidationErrors()},error:this.state.passwordError.length>0,helperText:this.state.passwordError})),i.a.createElement($,{rows:"5",columns:"1/3"},i.a.createElement(L.a,{type:"password",required:!0,label:"Confirm Password",className:e.textField,value:this.state.confirmPassword,onChange:e=>{this.setState({confirmPassword:e.target.value}),this.clearValidationErrors()},error:this.state.confirmPasswordError.length>0,helperText:this.state.confirmPasswordError})),i.a.createElement($,{rows:"6",columns:"1/3"},'The first thing we need to do is create an login for you that will be registered as the "Administrator" of this system.'),i.a.createElement($,{rows:"7",columns:"1/3"},"After you login, you will be able to create accounts for each member of your family, in the ",i.a.createElement("strong",null,"User Manager.")),i.a.createElement($,{rows:"8",columns:"1/3",style:{textAlign:"right"}},i.a.createElement(_,{isLoading:this.state.isLoading,label:"Create User",onClick:this.handleSubmit}))))}}var Z=Object(l.d)(Object(v.a)(e=>({loginCardForm:{padding:"20px",width:"100%",backgroundColor:"#ffffff"},textField:{width:"100%"}}))(SignupCard_SignupCard));class LoginPage_Login extends a.Component{constructor(e,t){super(e),this.state={isMounted:!0,users:void 0,activeUser:void 0,offlineImage:"/images/hex-grid-blue_tran.jpg",backgrounds:["/images/AS6_9771-180__.jpg","/images/lake-marina_GkuzZvKu__.jpg","/images/DSC_5803-777__.jpg","/images/pebble-stack_XJX4rE__.jpg","/images/fire-texture-15_GyOwSEFd__.jpg","/images/lake_GyXLZDKu__.jpg"]},this.handleLogin=this.handleLogin.bind(this),this.handleCancelCardSelection=this.handleCancelCardSelection.bind(this),this.handleCardSelection=this.handleCardSelection.bind(this)}componentWillMount(){this.setState({isMounted:!0,isLoading:!0}),J.getAllUsers.sink.takeWhile(()=>this.state.isMounted).subscribe(e=>{this.setState({isLoading:!1}),e&&this.setState({users:e})}),I.logout.source.next(!0),J.getAllUsers.source.next(!0)}componentWillUnmount(){this.setState({isMounted:!1})}handleCardSelection(e){this.setState({activeUser:e})}handleCancelCardSelection(e){this.setState({activeUser:void 0})}handleLogin(e,t){D.login.source.next({username:e,password:t}),D.login.sink.subscribe(e=>{console.log("AuthActions.login.sink: SUCCESS"),console.dir(e)},e=>{console.log("AuthActions.login.sink: ERROR"),console.dir(e),window.alert(e.message)})}randomIntFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}render(){const e=this.props.classes,t=this.state.backgrounds[this.randomIntFromInterval(0,this.state.backgrounds.length)];return this.state.isLoading?i.a.createElement("div",{className:e.loginView},i.a.createElement(S.a,{className:e.progress,size:50})):i.a.createElement("div",{className:e.loginView,style:{background:"url('"+this.state.offlineImage+"') no-repeat"}},i.a.createElement("div",{className:e.loginView,style:{background:"url('"+t+"') no-repeat"}},this.state.users&&0!==this.state.users.length?i.a.createElement(T,{users:this.state.users,onLogin:this.handleLogin}):i.a.createElement(Z,null),i.a.createElement("div",{className:e.timeClock},i.a.createElement(E,null))))}}var Y=Object(l.d)(Object(v.a)(e=>({wrapper:{},loginView:{position:"absolute",top:0,right:0,left:0,bottom:0,display:"flex",flexGrow:1,flexWrap:"wrap",alignItems:"center",justifyContent:"center",height:"100vh",backgroundSize:"cover !important",backgroundRepeat:"no-repeat !important"},timeClock:{position:"absolute",bottom:"20px",right:"40px",width:"280px"},progress:{margin:"0 ".concat(2*e.spacing.unit,"px"),width:"100px",height:"100px",position:"absolute",top:"50%",left:"50%"}}))(LoginPage_Login));class App_App extends a.Component{constructor(e,t){super(e,t),this.state={context:t,locale:"en-EN",isLoading:!1,isMounted:!0}}componentDidMount(){this.setState({isMounted:!0})}componentWillUnmount(){this.setState({isMounted:!1})}render(){return i.a.createElement(l.b,{locale:"en-EN",key:"en-EN",messages:this.props.i18nMessages["en-EN"]},i.a.createElement(Y,{mode:"login"}))}}var Q=Object(v.a)(e=>({}))(App_App);Object(l.c)(s(432));const ee={"en-EN":s(433)},te=Object(d.a)({palette:{type:"light",primary:u.a,secondary:Object(r.a)({},g.a),error:f.a}});!function renderApp(){o.a.render(i.a.createElement(h.a,{theme:te},i.a.createElement(Q,{i18nMessages:ee})),document.getElementById("root"))}(),function register(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("","/service-worker.js");c?function checkValidServiceWorker(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):registerValidSW(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):registerValidSW(e)})}}()}},[[156,1,2]]]);
//# sourceMappingURL=main.adf85363.chunk.js.map