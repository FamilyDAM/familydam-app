(this.webpackJsonpfiles=this.webpackJsonpfiles||[]).push([[0],{385:function(e,t,n){},657:function(e,t){},658:function(e,t){},802:function(e){e.exports=JSON.parse("{}")},803:function(e,t,n){"use strict";n.r(t);var a=n(269),i=n(0),r=n.n(i),o=n(29),s=n.n(o),l=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function registerValidSW(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(384);var c=n(355),d=n(865),u=n(352),p=n.n(u),h=n(353),f=n.n(h),g=n(354),m=n.n(g),b=(n(385),n(30)),v=n(33),w=n(82),y=n(81),k=n(155),S=n(64),C=n(871),x=n(19),F=n(864),O=(n(386),n(63)),j=n.n(O),E=n(84),D=n(52),T=n(325),N=n(854),M=n(855),A=n(363),R=n(868),L=n(876),P=n(877),U=n(78),H=n(880),I=n(879),W=n(881),V=n(878),_=n(303),G=n(360),B=n(851),z=n(806),Y=n(882),$=n(852),q=n(807),K=n(853),J=n(273),Q=n(324),X=n.n(Q),Z=n(288),ee=n.n(Z),te=n(23),ne=new function AppSettings(){Object(b.a)(this,AppSettings),this.baseHost=new te.BehaviorSubject("http://localhost:9000"),this.basicUser=new te.BehaviorSubject(window.localStorage.getItem("u")),this.basicPwd=new te.BehaviorSubject(window.localStorage.getItem("p"))},ae=function(){function LogoutService(e,t){Object(b.a)(this,LogoutService),this.sink=void 0,this.sink=t,e.subscribe(this.getUser.bind(this))}return Object(v.a)(LogoutService,[{key:"getUser",value:function getUser(e){var t=this,n=ne.baseHost.getValue();fetch(n+"/logout",{method:"GET"}).then((function(e){return e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),e})).catch((function(e){if(401===e.status||403===e.status)window.location="/";else{var n={code:e.status,status:e.statusText,message:e.responseText};t.sink.error(n)}}))}}]),LogoutService}(),ie=new function AppActions(){Object(b.a)(this,AppActions),this.navigateTo=new te.Subject,this.logout={source:new te.Subject,sink:new te.Subject},this.logoutService=new ae(this.logout.source,this.logout.sink)},re=function(e){Object(w.a)(Sidebar,e);var t=Object(y.a)(Sidebar);function Sidebar(){return Object(b.a)(this,Sidebar),t.apply(this,arguments)}return Object(v.a)(Sidebar,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e,t){return e.open!==this.props.open||e.user!==this.props.user||e.apps!==this.props.apps||e.secondaryApps!==this.props.secondaryApps}},{key:"handleLogout",value:function handleLogout(){window.localStorage.clear(),ie.logout.source.next(!0),window.location="/index.html"}},{key:"findApp",value:function findApp(e,t){if(t){var n,a=Object(G.a)(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.slug===e)return i}}catch(r){a.e(r)}finally{a.f()}}return null}},{key:"render",value:function render(){var e=this,t=this.props.classes,n=this.findApp("usermanager",this.props.secondaryApps);return r.a.createElement(z.a,{className:this.props.open?t.sidebarOpen:t.sidebarClosed},r.a.createElement(z.a,{className:this.props.open?t.sidebarUserInfo:t.sidebarUserInfoClosed},r.a.createElement("div",{className:t.sidebarProfileIcon},r.a.createElement(ee.a,{style:{width:60,height:60}})),r.a.createElement("div",{className:t.sidebarProfileName},r.a.createElement(J.a,{component:"div",type:"title"},this.props.user.name," ",this.props.user.lastName)),r.a.createElement("div",{className:t.sidebarButtons},r.a.createElement(B.a,{onClick:this.handleLogout},"Logout"),n&&r.a.createElement(B.a,{onClick:function onClick(){return ie.navigateTo.next(n.path)}},"Profile"))),r.a.createElement("div",{className:this.props.open?t.appListsOpen:t.appListsClosed},r.a.createElement("div",{style:{gridColumn:"1",gridRow:"1"}},r.a.createElement(J.a,{type:"title",className:this.props.open?t.openLabel:t.closedLabel,style:{paddingLeft:"16px",paddingTop:"16px",gridColumn:"1",gridRow:"1"}},"Apps")),r.a.createElement($.a,{style:{gridColumn:"1",gridRow:"2"}},this.props.apps&&this.props.apps.map((function(n){return r.a.createElement(q.a,{button:!0,key:n.path,onClick:function onClick(){return window.location.href=n.path}},r.a.createElement(Y.a,{style:{marginRight:"8px"}},r.a.createElement(X.a,null)),r.a.createElement(K.a,{primary:n.label,primaryTypographyProps:{type:"body2"},className:e.props.open?t.openLabel:t.closedLabel}))}))),r.a.createElement($.a,{style:{gridColumn:"1",gridRow:"3"},className:this.props.open?t.closedLabel:t.openLabel},r.a.createElement(q.a,{button:!0,onClick:function onClick(){return window.location.href="://app-usermanager/index.html"}},r.a.createElement(Y.a,null,r.a.createElement(ee.a,{style:{width:48,height:48}}))))))}}]),Sidebar}(i.Component),oe=Object(T.b)(Object(x.a)((function styleSheet(e){return{sidebarOpen:{width:"240px",minHeight:"100vh",height:"100%",background:"#fff"},sidebarClosed:{width:"72px",minHeight:"100vh",height:"100%",background:"#fff"},sidebarUserInfo:{width:"100%",padding:"8px",display:"grid",gridGap:"8px",gridTemplateRows:"auto",gridTemplateColumns:"60px auto"},sidebarUserInfoClosed:{display:"none"},sidebarProfileIcon:{gridColumn:"1",gridRow:"1"},sidebarProfileName:{gridColumn:"2",gridRow:"1",alignSelf:"center"},sidebarButtons:{gridColumn:"1/3",gridRow:"2",justifySelf:"center"},appListsOpen:{display:"grid",gridGap:"0px",gridTemplateRows:"24px auto",gridTemplateColumns:"auto",marginTop:"16px"},appListsClosed:{height:"90%",display:"grid",gridGap:"0px",gridTemplateRows:"0px auto 72px",gridTemplateColumns:"auto"},openLabel:{display:"inline"},closedLabel:{display:"none"}}}))(re)),se=n(856),le=n(858),ce=n(358),de=n(857),ue=n(328),pe=n.n(ue),he=n(327),fe=n.n(he),ge=function(e){Object(w.a)(AppHeader,e);var t=Object(y.a)(AppHeader);function AppHeader(e,n){var a;return Object(b.a)(this,AppHeader),(a=t.call(this,e)).state={openMoreMenu:!1},a.handleToggle=a.handleToggle.bind(Object(D.a)(a)),a.handleOpenMoreMenu=a.handleOpenMoreMenu.bind(Object(D.a)(a)),a.handleLogout=a.handleLogout.bind(Object(D.a)(a)),a}return Object(v.a)(AppHeader,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e,t){return e.onToggle!==this.props.onToggle||e.apps!==this.props.apps||t.openMoreMenu!==this.state.openMoreMenu}},{key:"handleOpenMoreMenu",value:function handleOpenMoreMenu(e){this.setState({openMoreMenu:!0,openMoreMenuAnchorEl:e.currentTarget})}},{key:"handleToggle",value:function handleToggle(){this.props.onToggle&&this.props.onToggle()}},{key:"handleNavClick",value:function handleNavClick(e){this.props.onNavClick&&this.props.onNavClick(e)}},{key:"handleMenuClose",value:function handleMenuClose(){this.setState({openMoreMenu:!1})}},{key:"handleLogout",value:function handleLogout(){window.localStorage.clear(),ie.logout.source.next(!0),window.location="/"}},{key:"render",value:function render(){var e=this,t=this.props.classes;return r.a.createElement(N.a,{className:t.root,position:"static"},r.a.createElement(M.a,null,r.a.createElement(se.a,{onClick:this.handleToggle,className:t.menuButton,color:"secondary","aria-label":"Menu"},r.a.createElement(fe.a,null)),r.a.createElement(J.a,{variant:"h5",color:"inherit",className:t.flex,onClick:function onClick(){return e.handleNavClick("://home/index.html")}},"Family ",r.a.createElement("i",null,"D.A.M")),r.a.createElement(se.a,{"aria-label":"More","aria-owns":this.state.open?"long-menu":null,"aria-haspopup":"true",onClick:this.handleOpenMoreMenu,className:t.moreButton},r.a.createElement(pe.a,null)),r.a.createElement(ce.a,{id:"long-menu",keepMounted:!0,anchorEl:this.state.openMoreMenuAnchorEl,open:this.state.openMoreMenu},r.a.createElement(de.a,{onClick:function onClick(){e.handleLogout(),e.handleMenuClose()}},"Logout"),r.a.createElement(le.a,null),this.props.apps&&this.props.apps.map((function(t){return r.a.createElement(de.a,{key:t.path,color:"secondary",onClick:function onClick(){window.location=t.path,e.handleMenuClose()}},t.label)})))))}}]),AppHeader}(i.Component),me=Object(T.b)(Object(x.a)((function styleSheet(e){return{root:{width:"100%",height:"64px"},headerContainer:{display:"grid",gridTemplateRows:"auto",gridTemplateColumns:"48px auto 48px"},hamburgerMenu:{display:"block",gridRow:"1",gridColumn:"1"},mainSection:{gridRow:"1",gridColumn:"2"},rightSection:{gridRow:"2",gridColumn:"3",textAlign:"right"},flex:{flex:1},menuButton:{marginLeft:-12,marginRight:20,color:"#ffffff"},moreButton:{color:"#ffffff"}}}))(ge)),be=new(function(){function LoadClientAppsService(){Object(b.a)(this,LoadClientAppsService),this.isLoading=new te.BehaviorSubject(!1),this.source=new te.Subject,this.sink=new te.Subject,this.source.subscribe(this.loadApps.bind(this))}return Object(v.a)(LoadClientAppsService,[{key:"loadApps",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a,i,r,o,s,l,c;return j.a.wrap((function _callee$(e){for(;;)switch(e.prev=e.next){case 0:return t=ne.baseHost.getValue(),n=t+"/api/v1/apps/",(a=new Headers).append("Accept","application/hal+json"),this.isLoading.next(!0),e.next=7,fetch(n,{method:"GET",cache:"no-cache",headers:a,credentials:"include"});case 7:return i=e.sent,e.next=10,i.json();case 10:r=e.sent,200==i.status&&r._embedded&&r._embedded.apps&&(o=[],s=[],r._embedded.apps.forEach((function(e){e.primary?o.push(e):s.push(e)})),l=o.sort((function(e,t){return e.order-t.order})),c=s.sort((function(e,t){return e.order-t.order})),this.sink.next({primaryApps:l,secondaryApps:c}));case 12:case"end":return e.stop()}}),_callee,this)})));return function loadApps(t){return e.apply(this,arguments)}}()}]),LoadClientAppsService}()),ve=function(e){Object(w.a)(AppShell,e);var t=Object(y.a)(AppShell);function AppShell(e,n){var a;Object(b.a)(this,AppShell),a=t.call(this,e);var i=window.localStorage.getItem("AppShell.isOpen");return i||(i=void 0===e.open||e.open),a.state={isMounted:!0,isOpen:Boolean(i)},a.handleOpenCloseToggle=a.handleOpenCloseToggle.bind(Object(D.a)(a)),a.handleOpenMoreMenu=a.handleOpenMoreMenu.bind(Object(D.a)(a)),a}return Object(v.a)(AppShell,[{key:"shouldComponentUpdate",value:function shouldComponentUpdate(e,t){return e.open!==this.props.open||e.user!==this.props.user||e.children!==this.props.children||t.isOpen!==this.state.isOpen||t.primaryApps!==this.state.primaryApps||t.secondaryApps!==this.state.secondaryApps}},{key:"componentDidMount",value:function componentDidMount(){var e=this;this.setState({isMounted:!0}),ie.navigateTo.pipe(Object(_.a)((function(){return e.state.isMounted}))).subscribe(function(e){"://"!==e&&"://"===e.substring(0,3)?window.location.href=e.substring(2):this.props.history&&this.props.history.push(e)}.bind(this)),be.sink.pipe(Object(_.a)((function(){return e.state.isMounted}))).subscribe((function(t){t&&e.setState({primaryApps:t.primaryApps||[],secondaryApps:t.secondaryApps||[]})})),be.source.next(!0)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({isMounted:!1})}},{key:"handleOpenMoreMenu",value:function handleOpenMoreMenu(e){this.setState({openMoreMenu:!0,openMoreMenuAnchorEl:e.currentTarget})}},{key:"handleOpenCloseToggle",value:function handleOpenCloseToggle(){var e=!this.state.isOpen;this.setState({isOpen:e}),window.localStorage.setItem("AppShell.isOpen",e)}},{key:"handleLogout",value:function handleLogout(){window.localStorage.clear(),ie.logout.source.next(!0),ie.navigateTo.next("://")}},{key:"render",value:function render(){var e=this.props.classes;return this.props.user?r.a.createElement("div",{className:this.state.isOpen?e.dashboardShellContainerOpen:e.dashboardShellContainerClosed},r.a.createElement("header",{className:e.header},r.a.createElement(me,{apps:this.state.secondaryApps,onToggle:this.handleOpenCloseToggle,onNavClick:function onNavClick(e){return window.location=e}})),r.a.createElement(oe,{user:this.props.user,apps:this.state.primaryApps,secondaryApps:this.state.secondaryApps,open:this.state.isOpen,onNavClick:function onNavClick(e){return window.location=e}}),r.a.createElement("div",{className:e.main},this.props.children)):r.a.createElement("div",null)}}]),AppShell}(i.Component),we=Object(T.b)(Object(S.f)(Object(x.a)((function styleSheet(e){return{dashboardShellContainerOpen:{display:"grid",gridTemplateRows:"64px auto",gridTemplateColumns:"240px auto"},dashboardShellContainerClosed:{display:"grid",gridTemplateRows:"64px auto",gridTemplateColumns:"72px auto"},header:{gridColumn:"1/3",gridRow:"1",position:"inherit",height:"64px"},main:{fontSize:".5rem",background:"#eee"}}}))(ve))),ye=n(872),ke=n(869),Se=n(131),Ce=n.n(Se),xe=function(){function GetFileDataService(e,t){Object(b.a)(this,GetFileDataService),this.sink=void 0,this.sink=t,e.subscribe(function(e){this.getFiles(e)}.bind(this))}return Object(v.a)(GetFileDataService,[{key:"getFiles",value:function getFiles(e){var t=this,n=ne.baseHost.getValue();if(void 0!==e&&e.length>0){for(var a=[],i=0;i<e.length;i++){var r=e[i],o=Ce.a.get(n+r).withCredentials().set("Accept","application/json");a.push(o)}Promise.all(a).then((function(e){for(var n=[],a=0;a<e.length;a++){var i=e[a];n.push(i.body)}t.sink.next(n)})).catch((function(e){console.log(e)}))}}}]),GetFileDataService}();n(635)(Ce.a);var Fe=function(){function UploadFileService(e,t){var n=this;Object(b.a)(this,UploadFileService),this.sink=void 0,this.sink=t;var a=ne.baseHost.getValue();e.mergeMap((function(e){if(!Array.isArray(e))return n.uploadNextFile(a,e);for(var t=0;t<e.length;t++){var i=e[t];return n.uploadNextFile(a,i)}}),3).subscribe(console.debug)}return Object(v.a)(UploadFileService,[{key:"uploadNextFile",value:function uploadNextFile(e,t){var n=this;return t?te.Observable.of(t).flatMap((function(a){return new Promise((function(a,i){return n.uploadFile(e,t).then((function(e){return a(e)})).catch((function(e){var n=1;return t.retry&&(n=t.retry+1),t.progress=0,t.retry=n,t.error="Retrying request ("+n+"/3)",i(e)}))}))})).retry(2).catch((function(e){return t.error=e.status+": "+e.message,t.progress=0,te.Observable.of(e)})):null}},{key:"uploadFile",value:function uploadFile(e,t){var n=t.uploadPath;t.webkitRelativePath?n+="/"+t.webkitRelativePath.substr(0,t.webkitRelativePath.lastIndexOf("/")):t.relativePath&&(n+=t.relativePath.substr(0,t.relativePath.lastIndexOf("/")));var a=new FormData;return a.append("name",t.name),a.append("path",n),a.append("destination",n),a.append("file",t),a.append("type",t.type),a.append("size",t.size),a.append("jcr:primaryType","nt:file"),a.append("dam:date.created",t.lastModified),a.append("dam:date.modified",t.lastModified),Ce.a.post(e+n).withCredentials().charset("UTF-8").send(a).parse((function(e){var t=e.text;return 0===t.length?{}:JSON.parse(t)})).on("progress",(function(e){t.progress=e.percent,De.uploadProgress.next(t)}))}}]),UploadFileService}(),Oe=function(){function DeleteFileOrFolderService(e,t){Object(b.a)(this,DeleteFileOrFolderService),this.sink=void 0,this.sink=t,e.subscribe(function(e){this.deleteFileOrFolder(e)}.bind(this))}return Object(v.a)(DeleteFileOrFolderService,[{key:"deleteFileOrFolder",value:function deleteFileOrFolder(e){var t=this,n=ne.baseHost.getValue();if(void 0!==e&&e.length>0){var a=n+e;Ce.a.delete(a).withCredentials().set("Accept","application/json").end((function(e,n){if(e)if(401===e.status)ie.navigateTo.next("/");else if(403===e.status)ie.alert.next("You do not have permission to access these files");else{var a={code:e.status,status:e.statusText,message:e.responseText};t.sink.error(a)}else t.sink.next(!0)}))}}}]),DeleteFileOrFolderService}(),je=function(){function CreateFolderService(e,t){Object(b.a)(this,CreateFolderService),this.sink=void 0,this.sink=t,e.subscribe(this.createDirectory.bind(this))}return Object(v.a)(CreateFolderService,[{key:"createDirectory",value:function createDirectory(e){var t=this,n=ne.baseHost.getValue(),a=e.name,i=n+e.path+"/"+a,r=new FormData;r.append("name",e.username),r.append("jcr:primaryType","nt:folder"),fetch(i,{method:"POST",body:r}).then((function(e){console.info("CreateFolder success handler"),e.redirected&&(console.debug("redirect to: "+e.url),window.location=e.url),t.sink.next(!0)})).then((function(e){return e.json()})).then((function(e){e.firstName||(e.firstName=e.username),t.sink.next(e)})).catch((function(e){if(console.warn(e),401===e.status)ie.navigateTo.next("/");else if(403===e.status)ie.alert.next("You do not have permission to add a new user");else{console.error(e);var n={code:e.status,status:e.statusText,message:e.responseText};t.sink.error(n)}}))}}]),CreateFolderService}(),Ee=function(){function SetFilePropertyService(e,t){Object(b.a)(this,SetFilePropertyService),this.sink=void 0,this.sink=t,e.subscribe(function(e){this.execute(e)}.bind(this))}return Object(v.a)(SetFilePropertyService,[{key:"execute",value:function execute(e){var t=this,n=ne.baseHost.getValue(),a=new FormData;for(var i in e)"path"!==i&&a.append(i,e[i]);fetch(n+e.path,{method:"PUT",body:a}).then((function(e){return e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),e})).then((function(e){return e.json()})).then((function(e){t.sink.next(e)})).catch((function(e){if(401===e.status||403===e.status)window.location="/";else{var n={code:e.status,status:e.statusText,message:e.responseText||e.message};t.sink.error(n)}}))}}]),SetFilePropertyService}(),De=new function FileActions(){Object(b.a)(this,FileActions),this.getFileData={source:new te.Subject,sink:new te.Subject},this.setFileProperty={source:new te.Subject,sink:new te.Subject},this.uploadFile={source:new te.Subject,sink:new te.Subject},this.deleteFileOrFolder={source:new te.Subject,sink:new te.Subject},this.createFolder={source:new te.Subject,sink:new te.Subject},this.stageAction=new te.Subject,this.stageFile=new te.Subject,this.uploadProgress=new te.Subject,this.uploadCompleted=new te.Subject,this.uploadError=new te.Subject,this.getFileDataService=new xe(this.getFileData.source,this.getFileData.sink),this.setFilePropertyService=new Ee(this.setFileProperty.source,this.setFileProperty.sink),this.uploadFileService=new Fe(this.uploadFile.source,this.uploadFile.sink),this.deleteFileOrFolderService=new Oe(this.deleteFileOrFolder.source,this.deleteFileOrFolder.sink),this.createFolderService=new je(this.createFolder.source,this.createFolder.sink)},Te=new(function(){function GetFilesAndFoldersService(){Object(b.a)(this,GetFilesAndFoldersService),this.isLoading=new te.BehaviorSubject(!1),this.sink=new te.Subject,this.source=new te.Subject,this.source.subscribe(function(e){this.getFilesAndFolders(e)}.bind(this))}return Object(v.a)(GetFilesAndFoldersService,[{key:"getFilesAndFolders",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a,i,r,o,s;return j.a.wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return t=ne.baseHost.getValue(),n=t+"/content/",e&&e.length>1&&(n=e.startsWith("http")?e:t+e),(a=new Headers).append("Accept","application/hal+json"),this.isLoading.next(!0),l.next=8,fetch(n,{method:"GET",cache:"no-cache",headers:a,credentials:"include"});case 8:return i=l.sent,l.next=11,i.json();case 11:if(r=l.sent,200!=i.status){l.next=17;break}r._embedded?(o=r._embedded.nodes.filter((function(e){return!e.name.startsWith(".")})),this.sink.next(o)):this.sink.next([]),this.isLoading.next(!1),l.next=25;break;case 17:return this.isLoading.next(!1),l.t0=i.status,l.t1=i.statusText,l.next=22,i.text();case 22:l.t2=l.sent,s={code:l.t0,status:l.t1,message:l.t2},this.sink.error(s);case 25:case"end":return l.stop()}}),_callee,this)})));return function getFilesAndFolders(t){return e.apply(this,arguments)}}()},{key:"getFilesAndFoldersOld",value:function getFilesAndFoldersOld(e){var t=this,n=ne.baseHost.getValue();if(void 0!==e&&e.length>0){var a=n+e;request.get(a).withCredentials().set("Accept","application/json").end((function(e,n){if(e)if(401===e.status)ie.navigateTo.next("/");else if(403===e.status)ie.alert.next("You do not have permission to access these files");else{var a={code:e.status,status:e.statusText,message:e.responseText};t.sink.error(a)}else{var i=[];n.body&&(i=n.body.filter((function(e){return!e.name.toString().startsWith(".")}))),t.sink.next(i)}}))}}}]),GetFilesAndFoldersService}()),Ne=function(e){Object(w.a)(NewFolderDialog,e);var t=Object(y.a)(NewFolderDialog);function NewFolderDialog(e,n){var a;return Object(b.a)(this,NewFolderDialog),(a=t.call(this,e)).showModal=function(){a.setState({open:!0})},a.hideModal=function(){a.setState({open:!1})},a.state={folderName:"",open:!1},a.handleSave=a.handleSave.bind(Object(D.a)(a)),a}return Object(v.a)(NewFolderDialog,[{key:"componentDidMount",value:function componentDidMount(){this.setState({isMounted:!0})}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({isMounted:!1})}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(e){this.props=e,this.setState({open:e.open})}},{key:"handleSave",value:function handleSave(){this.props.onSave&&this.state.folderName.length>0&&this.props.onSave(this.state.folderName),this.setState({open:!1})}},{key:"render",value:function render(){var e=this;return r.a.createElement(ye.a,{visible:this.state.open,onCancel:this.hideModal,onOk:this.handleSave,okText:"Create",cancelText:"Cancel",title:"New Folder"},r.a.createElement(ke.a,{id:"newFolderName",label:"Folder Name",value:this.state.folderName,onChange:function onChange(t){return e.setState({folderName:t.target.value})},margin:"dense"}))}}]),NewFolderDialog}(i.Component),Me=Object(x.a)((function styleSheet(e){return{}}))(Ne),Ae=n(866),Re=n(875),Le=n(867),Pe=n(863),Ue=n(873),He=n(870),Ie=n(212),We=n(874),Ve=n(859),_e=n(860),Ge=n(861),Be=n(862),ze=n(291),Ye=n.n(ze),$e=Ue.a.TextArea,qe=He.a.TabPane,Ke=Ie.a.Option,Je=function(e){Object(w.a)(SingleImageView,e);var t=Object(y.a)(SingleImageView);function SingleImageView(e,n){var a;return Object(b.a)(this,SingleImageView),(a=t.call(this,e,n)).state={keyword:"",tabIndex:a.props.tabIndex?a.props.tabIndex:0},a.handleRatingChange=a.handleRatingChange.bind(Object(D.a)(a)),a.handleTagChange=a.handleTagChange.bind(Object(D.a)(a)),a.handleDescriptionChange=a.handleDescriptionChange.bind(Object(D.a)(a)),a.handleDescriptionSave=a.handleDescriptionSave.bind(Object(D.a)(a)),a}return Object(v.a)(SingleImageView,[{key:"handleRatingChange",value:function handleRatingChange(e){this.props.node.rating=e,this.props.onRatingChange&&this.props.onRatingChange(this.props.node),this.setState({rating:e})}},{key:"handleTagChange",value:function handleTagChange(e){this.props.node.tags=e,this.props.onTagChange&&this.props.onTagChange(this.props.node),this.setState({tags:e})}},{key:"handleDescriptionChange",value:function handleDescriptionChange(e){this.props.node.description=e.currentTarget.value,this.setState({description:e.currentTarget.value})}},{key:"handleDescriptionSave",value:function handleDescriptionSave(e){this.props.onDescriptionChange&&this.props.onDescriptionChange(this.props.node)}},{key:"render",value:function render(){var e=this.props.classes,t=[];return this.props.node.tags&&this.props.node.tags.map((function(e){t.push(r.a.createElement(Ke,{key:e},e))})),r.a.createElement("div",{className:e.gridListRoot},r.a.createElement("div",{className:e.itemPreview},r.a.createElement("div",{style:{height:"100%",maxWidth:"100%",textAlign:"center"}},r.a.createElement("img",{src:ne.baseHost.getValue()+this.props.node.path,alt:this.props.node.path,style:{maxHeight:"100%",maxWidth:"100%",alignSelf:"center"}}))),r.a.createElement("div",{className:e.itemRating},r.a.createElement(We.a,{allowHalf:!0,onChange:this.handleRatingChange,value:this.props.node.rating,style:{float:"right"}})),r.a.createElement("div",{className:e.itemKeywords},r.a.createElement(J.a,{variant:"h6"},"Keywords:"),r.a.createElement(Ie.a,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",value:this.props.node.tags,onChange:this.handleTagChange},t)),r.a.createElement("div",{className:e.itemDescription},r.a.createElement(J.a,{variant:"h6"},"Description:"),r.a.createElement($e,{id:"description",rows:3,value:this.props.node.description,onChange:this.handleDescriptionChange,onBlur:this.handleDescriptionSave})),r.a.createElement("div",{className:e.itemInfo},r.a.createElement(He.a,{defaultActiveKey:"details",style:{width:"100%"}},r.a.createElement(qe,{tab:"Details",key:"details"},r.a.createElement("div",null,r.a.createElement(Ve.a,null,r.a.createElement(_e.a,null,r.a.createElement(Ge.a,{style:{padding:"8px"}},r.a.createElement(Be.a,{component:"th",scope:"row",align:"right",style:{padding:"8px"}},"Type"),r.a.createElement(Be.a,{align:"left"},this.props.node.mimeType)),r.a.createElement(Ge.a,null,r.a.createElement(Be.a,{component:"th",scope:"row",align:"right",style:{padding:"8px"}},"Resolution"),r.a.createElement(Be.a,{align:"left"},this.props.node.width," x ",this.props.node.height)),r.a.createElement(Ge.a,null,r.a.createElement(Be.a,{component:"th",scope:"row",align:"right",style:{padding:"8px"}},"Created"),r.a.createElement(Be.a,{align:"left"},Ye()(this.props.node.dateCreated).format("MMM Do YYYY, h:mm:ss a"))),r.a.createElement(Ge.a,null,r.a.createElement(Be.a,{component:"th",scope:"row",align:"right",style:{padding:"8px"}},"Modified"),r.a.createElement(Be.a,{align:"left"},Ye()(this.props.node.dateLastModified).format("MMM Do YYYY, h:mm:ss a"))))),r.a.createElement("br",null),r.a.createElement("p",null,this.props.node.path))),r.a.createElement(qe,{tab:"Versions",key:"versions"},"(coming soon)"),r.a.createElement(qe,{tab:"Duplicates",key:"duplicates"},"(coming soon)"))))}}]),SingleImageView}(i.Component),Qe=Object(x.a)((function styleSheet(e){return{gridListRoot:{margin:"0px",display:"grid",gridGap:"8px",gridTemplateRows:"175px 25px 50px 25px 50px 25px 25px 3fr",gridTemplateColumns:"16px auto 16px",background:e.palette.background.paper,justifyContent:"center"},itemPreview:{gridRow:"1",gridColumn:"2",justifyContent:"center"},itemRating:{gridRow:"2",gridColumn:"2"},itemKeywords:{gridRow:"3",gridColumn:"2"},itemDescription:{gridRow:"5",gridColumn:"2",width:"100%"},itemInfo:{gridRow:"8",gridColumn:"2"}}}))(Je),Xe=function(e){Object(w.a)(TableView,e);var t=Object(y.a)(TableView);function TableView(e){var n;return Object(b.a)(this,TableView),(n=t.call(this,e)).state={isMounted:!0,showDeleteFileDialog:!1,showSidebar:!1,pendingFileToDelete:[],folders:[],files:[],selectedFile:{}},n.handleRowClick=n.handleRowClick.bind(Object(D.a)(n)),n.handleFileDelete=n.handleFileDelete.bind(Object(D.a)(n)),n.handleFileDeleteConfirmation=n.handleFileDeleteConfirmation.bind(Object(D.a)(n)),n.handleFolderDelete=n.handleFolderDelete.bind(Object(D.a)(n)),n.handleFolderDeleteConfirmation=n.handleFolderDeleteConfirmation.bind(Object(D.a)(n)),n.handleNodeChange=n.handleNodeChange.bind(Object(D.a)(n)),n}return Object(v.a)(TableView,[{key:"handleRowClick",value:function handleRowClick(e){var t=e.currentTarget.attributes["data-id"].value;this.props.onRowClick(t)}},{key:"onTableChangeHandler",value:function onTableChangeHandler(e,t,n,a){console.log("onTableChange")}},{key:"handleFileDelete",value:function handleFileDelete(e){var t=e.currentTarget.attributes["data-path"].value;return this.setState({showDeleteFileDialog:!0,deletePath:t}),!1}},{key:"handleFileDeleteConfirmation",value:function handleFileDeleteConfirmation(e){return this.props.onDeleteFile&&this.props.onDeleteFile(this.state.deletePath),this.setState({showDeleteFileDialog:!1,deletePath:null}),!1}},{key:"handleFolderDelete",value:function handleFolderDelete(e){var t=e.currentTarget.attributes["data-path"].value;return this.setState({showDeleteFolderDialog:!0,deletePath:t}),!1}},{key:"handleFolderDeleteConfirmation",value:function handleFolderDeleteConfirmation(e){return this.props.onDeleteFolder&&this.props.onDeleteFolder(this.state.deletePath),this.setState({showDeleteFolderDialog:!1,deletePath:null}),!1}},{key:"handleNodeChange",value:function handleNodeChange(e){this.props.onNodeChange&&this.props.onNodeChange(e)}},{key:"fieldNameSorter",value:function fieldNameSorter(e,t,n){return console.log(n),"nt:folder"===e.primaryType&&"nt:file"===t.primaryType?-1:"nt:file"===e.primaryType&&"nt:folder"===t.primaryType?1:e.primaryType===t.primaryType?e.name.trim().toLowerCase()<t.name.trim().toLowerCase()?-1:e.name.trim().toLowerCase()>t.name.trim().toLowerCase()?1:0:0}},{key:"fieldDateSorter",value:function fieldDateSorter(e,t,n,a){return"nt:folder"===e.primaryType&&"nt:file"===t.primaryType?-1:"nt:file"===e.primaryType&&"nt:folder"===t.primaryType?1:e.primaryType===t.primaryType?e.createdDate<t.createdDate?"ascend"===n?1:-1:e.createdDate>t.createdDate?"ascend"===n?-1:1:0:0}},{key:"getColumns",value:function getColumns(){var e=this;return[{title:"",dataIndex:"type",width:30,render:function render(e,t){return"nt:folder"===t.primaryType?r.a.createElement(V.a,{style:{fontSize:"24px"}}):"nt:file"===t.primaryType&&t.mimeType.startsWith("image/")?r.a.createElement("img",{src:t.path+"?size=100",alt:"",style:{width:"24px"}}):r.a.createElement(I.a,{style:{fontSize:"24px"}})}},{title:"Name",dataIndex:"name",key:"name",sorter:this.fieldNameSorter,render:function render(t,n){return"nt:folder"===n.primaryType?r.a.createElement(k.b,{to:n.path},t):r.a.createElement("a",{onClick:function onClick(){return e.setState({showSidebar:!0,selectedFile:n})}},t)}},{title:"Date Created",dataIndex:"dateCreated",key:"dateCreated",width:200,responsive:["md"],sorter:this.fieldDateSorter,render:function render(e){return r.a.createElement("span",null,e?Object(Le.a)(Object(Pe.a)(e||""),"yyyy-MM-dd hh:mm:ss a"):"")}},{title:"Action",key:"action",width:200,render:function render(t,n){var a=n._links.download&&e.props.onDownload?r.a.createElement(B.a,{type:"link","data-path":n.path,onClick:function onClick(){return e.props.onDownload(n.name,n._links.download.href)}},"Download"):r.a.createElement("span",null),i=n._links.self?r.a.createElement(B.a,{type:"link","data-path":n.path,onClick:e.handleFileDelete},"Delete"):r.a.createElement("span",null),o=r.a.createElement("span",null);return"nt:file"===n.primaryType&&n.mimeType.startsWith("image/")?r.a.createElement(P.b,{size:"middle"},a,i,o):r.a.createElement(P.b,{size:"middle"},a,i)}}]}},{key:"getRowSelection",value:function getRowSelection(){return{onChange:function onChange(e,t){console.log("selectedRowKeys: ".concat(e),"selectedRows: ",t)},getCheckboxProps:function getCheckboxProps(e){return{disabled:"application/folder"===e.contentType,name:e.name}}}}},{key:"render",value:function render(){var e=this,t=(this.props.classes,[]);(t=(t=t.concat(this.props.folders)).concat(this.props.files)).sort(this.fieldNameSorter);var n=this.getRowSelection();return r.a.createElement("div",null,r.a.createElement(Ae.a,{rowKey:"path",loading:this.props.loading,columns:this.getColumns(),dataSource:t,size:"small",pagination:{pageSize:10,hideOnSinglePage:!1},sortDirections:["ascend","descend"],rowSelection:Object(a.a)({type:"checkbox"},n),onChange:this.onTableChangeHandler}),r.a.createElement(Re.a,{title:"File Info",placement:"right",closable:!0,getContainer:!1,width:"350",bodyStyle:{padding:"0px"},onClose:function onClose(){return e.setState({showSidebar:!1,selectedFile:{}})},visible:this.state.showSidebar},r.a.createElement(Qe,{node:this.state.selectedFile,onRatingChange:this.handleNodeChange,onDescriptionChange:this.handleNodeChange,onTagChange:this.handleNodeChange})),r.a.createElement(ye.a,{visible:this.state.showDeleteFileDialog,onCancel:function onCancel(){e.setState({showDeleteFileDialog:!1})},onOk:this.handleFileDeleteConfirmation,okText:"Yes",cancelText:"No",title:"Are you sure?"},r.a.createElement("p",null,"Do you want to delete this file?")),r.a.createElement(ye.a,{visible:this.state.showDeleteFolderDialog,onCancel:function onCancel(){e.setState({showDeleteFolderDialog:!1})},onOk:this.handleFolderDeleteConfirmation,okText:"Yes",cancelText:"No",title:"Are you sure?"},r.a.createElement("p",null,"Do you want to delete this folder and all files in it?")))}}]),TableView}(r.a.PureComponent),Ze=Object(S.f)(Xe),et=new(function(){function CreateFolderService(e,t){Object(b.a)(this,CreateFolderService),this.sink=new te.Subject,this.source=new te.Subject,this.isLoading=new te.BehaviorSubject,this.source.subscribe(function(e){this.createDirectory(e)}.bind(this))}return Object(v.a)(CreateFolderService,[{key:"createDirectory",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a,i,r,o,s;return j.a.wrap((function _callee$(l){for(;;)switch(l.prev=l.next){case 0:return t=ne.baseHost.getValue(),e.name,n=t+e.path+"/",(a=new FormData).append("name",e.name),a.append("jcr:primaryType","nt:folder"),l.prev=6,l.next=9,fetch(n,{method:"POST",body:a,credentials:"include"});case 9:if(200!=(i=l.sent).status){l.next=19;break}return l.next=13,i.json();case 13:r=l.sent,o=r._links.self.href,this.sink.next(o),this.isLoading.next(!1),l.next=20;break;case 19:throw new Error("Unknown Error");case 20:l.next=28;break;case 22:l.prev=22,l.t0=l.catch(6),console.dir(l.t0),s={code:l.t0.status,status:l.t0.statusText,message:l.t0.responseText},this.sink.error(s),this.isLoading.next(!1);case 28:case"end":return l.stop()}}),_callee,this,[[6,22]])})));return function createDirectory(t){return e.apply(this,arguments)}}()}]),CreateFolderService}()),tt=n(115),nt=new(function(){function UploadFileService(e,t){var n=this;Object(b.a)(this,UploadFileService),this.sink=new te.Subject,this.source=new te.Subject,this.isLoading=new te.BehaviorSubject,this.source.pipe(Object(tt.b)((function(e){if(!Array.isArray(e))return n.uploadNextFile(e);for(var t=0;t<e.length;t++){e[t];return n.uploadNextFile(e)}}),3)).subscribe(console.debug)}return Object(v.a)(UploadFileService,[{key:"uploadNextFile",value:function uploadNextFile(e){var t=this;return e.file?te.Observable.of(e).flatMap((function(n){return new Promise((function(n,a){return t.uploadFile(e).then((function(e){return n(e)})).catch((function(t){var n=1;return e.retry&&(n=e.retry+1),e.progress=0,e.retry=n,e.errorMsg="Retrying request ("+n+"/3)",a(t)}))}))})).retry(2).catch((function(t){return e.errorMsg=t.status+": "+t.message,e.progress=0,te.Observable.of(t)})):null}},{key:"uploadFile",value:function uploadFile(e){var t=e.path;e.file.webkitRelativePath?t=e.file.webkitRelativePath:e.file.relativePath&&(t+=e.file.relativePath.substr(0,e.file.relativePath.lastIndexOf("/")));var n=new FormData;n.append("name",e.file.name),n.append("path",t),n.append("destination",t),n.append("file",e.file),n.append("type",e.file.type),n.append("size",e.file.size),n.append("jcr:primaryType","nt:file"),n.append("dam:date.created",e.file.lastModified),n.append("dam:date.modified",e.file.lastModified),console.log("Upload to:"+a+t);var a=ne.baseHost.getValue(),i=a+e.path;return Ce.a.post(i).withCredentials().charset("UTF-8").send(n).parse((function(t){t.text;e.onSuccess&&e.onSuccess(null,e.file)})).on("progress",(function(t){e.progress=t.percent,e.onProgress&&e.onProgress({percent:t.percent})}))}},{key:"execute",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a,i,r,o,s,l,c,d;return j.a.wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:return t=ne.baseHost.getValue(),n=e.file.name,a=t+e.path,e.file.type,i="/",e.file.webkitRelativePath&&(i=e.file.webkitRelativePath),(r=new FormData).append("name",n),r.append("path",e.path),r.append("destination",i),r.append("file",e.file),r.append("type",e.file.type),r.append("size",e.file.size),r.append("jcr:primaryType","nt:file"),r.append("dam:date.created",e.file.lastModified),r.append("dam:date.modified",e.file.lastModified),u.prev=16,u.next=19,fetch(a,{method:"POST",body:r,credentials:"include"});case 19:o=u.sent,s=o.body.getReader(),l=0;case 22:return u.next=25,s.read();case 25:if(!(c=u.sent).done){u.next=31;break}return console.log("Fetch complete"),e.onSuccess&&e.onSuccess(null,e.file),this.isLoading.next(!1),u.abrupt("break",36);case 31:l+=c.value.length,console.log("Received",l,"/",e.file.size,"bytes of data so far | ",e.file.name),e.onProgress&&e.onProgress({percent:l/e.file.size*100}),u.next=22;break;case 36:u.next=45;break;case 38:u.prev=38,u.t0=u.catch(16),e.onError&&e.onError(u.t0),console.dir(u.t0),d={code:u.t0.status,status:u.t0.statusText,error:u.t0.message},this.sink.error(d),this.isLoading.next(!1);case 45:case"end":return u.stop()}}),_callee,this,[[16,38]])})));return function execute(t){return e.apply(this,arguments)}}()}]),UploadFileService}()),at=new(function(){function DeleteFileOrFolderService(){Object(b.a)(this,DeleteFileOrFolderService),this.isLoading=new te.BehaviorSubject}return Object(v.a)(DeleteFileOrFolderService,[{key:"execute",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a;return j.a.wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return t=ne.baseHost.getValue(),n=t+e,i.prev=3,this.isLoading.next(!0),i.next=7,fetch(n,{method:"DELETE",credentials:"include"});case 7:if(200!=i.sent.status){i.next=12;break}this.isLoading.next(!1),i.next=13;break;case 12:throw new Error("Unknown Error");case 13:i.next=21;break;case 15:i.prev=15,i.t0=i.catch(3),console.dir(i.t0),a={code:i.t0.status,status:i.t0.statusText,message:i.t0.responseText},this.sink.error(a),this.isLoading.next(!1);case 21:case"end":return i.stop()}}),_callee,this,[[3,15]])})));return function execute(t){return e.apply(this,arguments)}}()}]),DeleteFileOrFolderService}()),it=new(function(){function SaveFileOrFolderService(e,t){Object(b.a)(this,SaveFileOrFolderService),this.sink=new te.Subject,this.source=new te.Subject,this.isLoading=new te.BehaviorSubject,this.source.subscribe(function(e){this.execute(e)}.bind(this))}return Object(v.a)(SaveFileOrFolderService,[{key:"execute",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){var t,n,a;return j.a.wrap((function _callee$(i){for(;;)switch(i.prev=i.next){case 0:return t=ne.baseHost.getValue(),e.name,n=t+e.path,i.prev=3,i.next=6,fetch(n,{method:"PUT",body:JSON.stringify(e),credentials:"include"});case 6:if(200!=i.sent.status){i.next=11;break}this.isLoading.next(!1),i.next=12;break;case 11:throw new Error("Unknown Error");case 12:i.next=20;break;case 14:i.prev=14,i.t0=i.catch(3),console.dir(i.t0),a={code:i.t0.status,status:i.t0.statusText,message:i.t0.responseText},this.sink.error(a),this.isLoading.next(!1);case 20:case"end":return i.stop()}}),_callee,this,[[3,14]])})));return function execute(t){return e.apply(this,arguments)}}()}]),SaveFileOrFolderService}()),rt=function(e){Object(w.a)(FilesPage,e);var t=Object(y.a)(FilesPage);function FilesPage(e,n){var a;return Object(b.a)(this,FilesPage),(a=t.call(this,e)).state={isLoading:!0,isMounted:!0,canAddFile:!0,canAddFolder:!0,showAddFolderDialog:!1,showUploadSidebar:!1,showNewFolderDialog:!1,showUploadDialog:!1,selectedFiles:[],uploadFiles:[],path:"/content/files",visibleRoot:"/content/files",folders:[],files:[]},a.fileInputFieldRef=r.a.createRef(),a.uploadRef=r.a.createRef(),a.handleFileDelete=a.handleFileDelete.bind(Object(D.a)(a)),a.handleFolderDelete=a.handleFolderDelete.bind(Object(D.a)(a)),a.handleNodeChange=a.handleNodeChange.bind(Object(D.a)(a)),a}return Object(v.a)(FilesPage,[{key:"componentDidMount",value:function componentDidMount(){var e=this;this.setState({isMounted:!0}),this.validatePath(),Te.isLoading.takeWhile((function(){return e.state.isMounted})).subscribe((function(t){e.setState({isLoading:t})})),et.isLoading.takeWhile((function(){return e.state.isMounted})).subscribe((function(t){e.setState({isLoading:t})})),Te.sink.takeWhile((function(){return e.state.isMounted})).subscribe((function(t){t.folders;var n=t.files||[];e.setState({folder:t,folders:t,files:n})})),it.sink.takeWhile((function(){return e.state.isMounted})).subscribe({next:function next(e){return A.b.info("Item has been saved")},error:function error(e){return A.b.info("Error saving item")}}),this.props.location.pathname.startsWith(this.state.path)?(this.setState({path:this.props.location.pathname}),Te.source.next(this.props.location.pathname)):Te.source.next(this.state.path)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({isMounted:!1})}},{key:"componentDidUpdate",value:function componentDidUpdate(e,t){this.setState({showAddFolderDialog:!1,showUploadSidebar:!1,showNewFolderDialog:!1,showUploadDialog:!1});var n=this.state.path,a=this.validatePath();n!==a&&Te.source.next(a)}},{key:"validatePath",value:function validatePath(){var e=this.props.path;return this.props.location.pathname&&this.props.location.pathname.toString().startsWith(this.state.visibleRoot)&&(e=this.props.location.pathname),e||(e=this.state.visibleRoot),e.toString().startsWith(this.state.visibleRoot)?(this.setState({path:e}),e):(console.log("Invalid Path: "+e),this.props.path)}},{key:"parseBreadcrumbPath",value:function parseBreadcrumbPath(e,t){var n=e.split("/");e.startsWith("/")&&(n=n.slice(1));for(var a=[],i=1;i<n.length;i++){var r=n[i];a.push({label:r,path:"/"+n.slice(0,i+1).join("/")})}return a}},{key:"handleCreateFolder",value:function handleCreateFolder(e){var t=this;this.state.folder.id,ne.baseHost.value;et.sink.takeWhile((function(){return t.state.isMounted})).subscribe(function(e){console.log("Create Folder:"+e),this.setState({showAddFolderDialog:!1,showUploadSidebar:!1,showNewFolderDialog:!1,showUploadDialog:!1}),Te.source.next(this.state.path)}.bind(this)),et.source.next({path:this.state.path,name:e})}},{key:"handleFileDelete",value:function(){var e=Object(E.a)(j.a.mark((function _callee(e){return j.a.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,at.execute(e);case 2:Te.source.next(this.state.path);case 3:case"end":return t.stop()}}),_callee,this)})));return function handleFileDelete(t){return e.apply(this,arguments)}}()},{key:"handleFolderDelete",value:function(){var e=Object(E.a)(j.a.mark((function _callee2(e){return j.a.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,at.execute(e);case 2:Te.source.next(this.state.path);case 3:case"end":return t.stop()}}),_callee2,this)})));return function handleFolderDelete(t){return e.apply(this,arguments)}}()},{key:"handleFileDownload",value:function handleFileDownload(e,t){var n=document.createElement("a");document.body.appendChild(n),n.href=t,n.download=e,n.click(),n.remove()}},{key:"UploadOnChangeHandler",value:function UploadOnChangeHandler(e){var t=e.file.status;if("done"===t){if(A.b.success("".concat(e.file.name," file uploaded successfully.")),e.fileList){var n=!0;e.fileList.forEach((function(e){"done"!==e.status&&(n=!1)})),n&&window.location.reload()}}else"error"===t&&A.b.error("".concat(e.file.name," file upload failed."))}},{key:"UploadCustomRequestHandler",value:function UploadCustomRequestHandler(e){nt.source.next({path:e.action,file:e.file,onError:e.onError,onProgress:e.onProgress,onSuccess:e.onSuccess})}},{key:"UploadItemRenderHandler",value:function UploadItemRenderHandler(e,t,n){if("done"!==t.status)return e}},{key:"handleOnRowClick",value:function handleOnRowClick(e){console.log(e)}},{key:"handleNodeChange",value:function handleNodeChange(e){it.source.next(e)}},{key:"render",value:function render(){var e=this,t=this.props.classes,n=this.state.showUploadSidebar||this.state.uploadFiles.length>0||this.state.selectedFiles.length>0,a=R.a.Dragger,i=(this.props.location,{name:"file",multiple:!0,listType:"picture",withCredentials:!0,directory:!0,showUploadList:{showRemoveIcon:!0,showPreviewIcon:!1,showDownloadIcon:!1},action:this.props.location.pathname,onChange:this.UploadOnChangeHandler.bind(this),customRequest:this.UploadCustomRequestHandler.bind(this),itemRender:this.UploadItemRenderHandler.bind(this)});A.b.config({top:24,duration:.5,maxCount:3});var o=this.parseBreadcrumbPath(this.props.location.pathname);return r.a.createElement(we,{user:this.props.user,open:!1},r.a.createElement("div",{className:t.fileGrid},r.a.createElement(N.a,{color:"default",position:"static",elevation:0,className:t.fileGridAppBar},r.a.createElement(M.a,{className:t.toolbarContainer},r.a.createElement(J.a,{variant:"h6",className:t.title},r.a.createElement(L.a,null,r.a.createElement(L.a.Item,{href:"/home/index.html"},r.a.createElement(H.a,null)),r.a.createElement(L.a.Item,{href:"#/"},r.a.createElement(I.a,null),r.a.createElement("span",null,"Files")),o.map((function(e){return r.a.createElement(L.a.Item,{key:e.path},r.a.createElement(k.b,{to:e.path},e.label))})))),r.a.createElement(P.b,null,r.a.createElement(U.a,{type:"primary",disabled:!this.state.canAddFolder,onClick:function onClick(){e.setState({showNewFolderDialog:!0})},icon:r.a.createElement(W.a,null)},"New Folder")))),r.a.createElement("div",{className:t.fileGridFileList,style:{gridColumn:n?"1/2":"1/3"}},r.a.createElement(Ze,{loading:this.state.isLoading,folders:this.state.folders,files:this.state.files,onRowClick:this.handleOnRowClick,onNodeChange:this.handleNodeChange,onDownload:this.handleFileDownload,onDeleteFile:this.handleFileDelete,onDeleteFolder:this.handleFolderDelete}),r.a.createElement("div",{style:{marginTop:"24px"}},r.a.createElement(a,Object.assign({},i,{ref:this.uploadRef}),r.a.createElement("p",{className:"ant-upload-drag-icon"},r.a.createElement(V.a,null)),r.a.createElement("p",{className:"ant-upload-text"},"Click or drag file to this area to upload"),r.a.createElement("p",{className:"ant-upload-hint"},"Support for a single or bulk upload. Strictly prohibit from uploading company data or other band files")))),r.a.createElement(Me,{onSave:this.handleCreateFolder.bind(this),onClose:function onClose(){e.setState({showNewFolderDialog:!1})},open:this.state.showNewFolderDialog,path:this.state.path})),r.a.createElement("input",{type:"file",ref:this.fileInputFieldRef,style:{display:"none"},multiple:!0,onChange:this.handleFileChange}))}}]),FilesPage}(r.a.PureComponent),ot=Object(T.b)(Object(S.f)(Object(x.a)((function styleSheet(e){return{progress:{margin:"0 ".concat(2*e.spacing(),"px"),width:"100px",height:"100px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},toolbarContainer:{},fileGrid:{height:"100%",display:"grid",gridTemplateRows:"64px auto",gridTemplateColumns:"4fr minmax(2px, 400px)"},fileGridAppBar:{gridRow:"1",gridColumn:"1/3",zIndex:500,colorDefault:"#eeeeee"},fileGridFileList:{gridRow:"2",gridColumn:"1",margin:"24px"},fileGridSidebar:{gridRow:"2",gridColumn:"2",margin:"24px"},filePondSidebar:{gridRow:"2",gridColumn:"2",margin:"24px"},mainGrid:{height:"100%",overflow:"scroll",display:"grid",gridGap:"16px",gridTemplateRows:"1fr 1fr 1fr",gridTemplateColumns:"2fr 6fr"},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}))(rt))),st=new(function(){function GetUsersService(){Object(b.a)(this,GetUsersService),this.isLoading=new te.BehaviorSubject(!1),this.source=new te.Subject,this.sink=new te.Subject,this.source.subscribe(this.getUser.bind(this))}return Object(v.a)(GetUsersService,[{key:"getUser",value:function getUser(e){var t=this,n=ne.baseHost.getValue()+"/api/v1/auth/user/me",a=new Headers;a.append("pragma","no-cache"),a.append("cache-control","no-cache"),a.append("accept","application/json"),this.isLoading.next(!0),fetch(n,{method:"GET",mode:"cors",headers:a,credentials:"include"}).then((function(e){return e.redirected&&(console.log("redirect to: "+e.url),window.location=e.url),e})).then((function(e){return e.json()})).then((function(e){t.sink.next(e)})).catch((function(e){if(401===e.status||403===e.status)window.location="/";else{console.error(e.statusText);var n={code:e.status,status:e.statusText,message:e.responseText||e.message};t.sink.error(n)}}))}}]),GetUsersService}()),lt=function(e){Object(w.a)(App,e);var t=Object(y.a)(App);function App(e,n){var a;return Object(b.a)(this,App),(a=t.call(this,e,n)).state={context:n,locale:"en-EN",isAuthenticated:!1,isLoading:!0,isMounted:!1},window.location.href.indexOf(":3000"),a}return Object(v.a)(App,[{key:"componentDidMount",value:function componentDidMount(){var e=this;this.setState({isMounted:!0}),st.sink.takeWhile((function(){return e.state.isMounted})).subscribe((function(t){t&&e.setState({isAuthenticated:!0,isLoading:!1,user:t})})),st.source.next(null)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.setState({isMounted:!1})}},{key:"render",value:function render(){var e=this,t=this.props.classes,n="en-EN";return this.state.isLoading?r.a.createElement("div",null,r.a.createElement(F.a,{className:t.progress,size:50})):r.a.createElement(C.a,{locale:n,key:n,messages:this.props.i18nMessages[n]},r.a.createElement(k.a,null,r.a.createElement(S.c,null,r.a.createElement(S.a,{path:"/",component:function component(){return r.a.createElement(ot,{user:e.state.user})}}))))}}]),App}(i.Component),ct=Object(x.a)((function styleSheet(e){return{progress:{margin:"0 ".concat(2*e.spacing(),"px"),width:"100px",height:"100px",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}}))(lt),dt={"en-EN":n(802)},ut=Object(c.a)({palette:{type:"light",primary:p.a,secondary:Object(a.a)({},f.a),error:m.a}});!function renderApp(){s.a.render(r.a.createElement(d.a,{theme:ut},r.a.createElement(ct,{i18nMessages:dt})),document.getElementById("root"))}(),function register(){if("serviceWorker"in navigator){if(new URL("/files",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/files","/service-worker.js");l?function checkValidServiceWorker(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):registerValidSW(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):registerValidSW(e)}))}}()}},[[803,1,2]]]);
//# sourceMappingURL=main.57315caf.chunk.js.map